# Doron システム 動作確認・テスト手順書

この手順書では、デプロイ後のシステムの各機能が正常に動作するかを確認するためのテストステップをまとめています。

## 1. 事前準備
- [ ] Google Apps Script を「ウェブアプリ」としてデプロイ完了している。
- [ ] LINE Developers コンソールで「Webhook URL」と「コールバックURL」を登録済みである。
- [ ] 設定画面（ウェブアプリのURL）から、すべての設定項目（パスキー、猶予期間、宛先など）を保存済みである。

---

## 2. LINE ID 取得テスト
公式Botから、設定に必要なIDが正しく取得できるかを確認します。

1.  **個人チャット**: 公式Botに「ID」とメッセージを送信する。
    - **期待結果**: 「あなたのユーザーIDは Uxxx... です」という返信が届くこと。
2.  **グループチャット**: 「自分・Bot・誰か（キーマン役）」のグループを作成し、そこで「ID」と送信する。
    - **期待結果**: 「このグループIDは Gxxx... です」という返信が届くこと。

---

## 3. 生存確認フローのテスト（手動起動）
実際に遺言フェーズまで行く前に、生存確認のフェーズをテストします。

1.  **トリガー実行**: 緊急起動用フォーム（パスキー入力画面）から正しいパスキーを入力する。
2.  **初期通知の確認**:
    - **自分**: LINEで「生存確認（ボタン付き）」のメッセージが届くこと。
    - **キーマン（宛先）**: LINEまたはメールで「システムが起動しました」という通知が届くこと。
3.  **停止（生存報告）の確認**:
    - 自分のLINEに届いた**「🛑 緊急停止（生きてます）」**ボタンを押す。
    - **期待結果**: 
        - 自分に「停止を受け付けました」と返信がくる。
        - キーマンに「本人が停止させたので安心してください」と通知が届く。

---

## 4. 実行フェーズのテスト（擬似テスト）
24時間待つのは大変なため、コード上で直接実行関数（`executeCleanup` または `sendLastMessagesToAll`）を呼び出してテストします。

1.  **遺言送信テスト**: GASのエディタから `sendLastMessagesToAll` 関数を直接実行する。
    - **期待結果**: 登録したすべての宛先（LINE/メール）に、設定した通りの遺言が届くこと。
2.  **外部連携テスト**: MacroDroidを設定している場合、`triggerDeviceWipe` を単体実行する。
    - **期待結果**: スマホ側でマクロが正常に反応すること。

---

## 5. データの消去テスト（慎重に行ってください）
**注意: 実際にデータが消えるため、テスト用の空フォルダやダミーのメールを対象にすることをお勧めします。**

1.  **Drive/Gmail消去**: GASエディタから `executeCleanup` などの消去用関数を実行する。
    - **期待結果**: 対象のファイルやメールが削除（ゴミ箱へ移動）されること。

---

## 💡 トラブルシューティング
- **通知が来ない**: `config.gs` の `LINE_ACCESS_TOKEN` が正しいか、LINE DevelopersのWebhookが有効か確認してください。
- **設定が保存されない**: ブラウザのコンソール（F12）を開き、`google.script.run` でエラーが出ていないか確認してください。

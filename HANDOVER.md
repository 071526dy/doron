# Doron Project Handover Document

このドキュメントは、開発者が交代した場合や、作業を中断・再開する際に進捗を把握するためのものです。

## 1. プロジェクト概要
「Doron」は、ユーザーの死亡や意識不明を想定した「デッドマンズスイッチ」システムです。
Google フォームの入力をトリガーに、24時間の生存確認（LINE）を行い、反応がない場合にデータの削除と遺告の送信を実行します。

## 2. 現在の進捗状況 (2026-01-02)
- [x] **コアロジック実装**: フォーム送信トリガー、24時間タイマー、実行フェーズの骨組み。
- [x] **LINE Messaging API連携**: 生存確認メッセージ（ボタン付き）、キャンセル処理の実装。
- [x] **データクリーニング機能**: Google DriveおよびGmailの削除ロジック（ゴミ箱への移動）。
- [x] **遺言・通知機能**: LINE/メールによる遺言送信、MacroDroid（Android初期化）連携。
- [x] **LINE ログイン統合**: ユーザーがIDを手動入力せず、ログインボタンで自動登録できる仕組み。

## 3. システム構成
- **言語**: Google Apps Script (GAS)
- **外部API**: LINE Messaging API, LINE Login API
- **ストレージ**: Script Properties (USER_LINE_IDの保持)

### ファイル構成
- `config.gs`: 定数・設定管理。
- `main.gs`: `doGet` (UI表示), `doPost` (Webhook), `onFormSubmit` 等のエントリポイント。
- `auth.gs`: LINEログインのOAuth2フロー。
- `line.gs`: メッセージ送信・返信ユーティリティ。
- `cleanup.gs`: Drive/Gmailの削除処理。
- `notifications.gs`: 最終通知・デバイス初期化キック。
- `index.html`: セットアップ用UI（LINEログインボタン）。

## 4. 未完了・今後の課題
- [ ] **エラーハンドリングの強化**: 権限不足時の通知やリトライロジック。
- [ ] **詳細なテスト**: 実際のフォーム送信から24時間待機、実行までのEnd-to-Endテスト（※データのバックアップ必須）。
- [ ] **物理破壊連携の設定**: 有料オプション（物理的な破壊サービス等）が発生した場合のAPI連携。

## 5. 開発者への引き継ぎ手順
1. `config.gs` に自身のLINEチャネル情報を入力する。
2. GASを「ウェブアプリ」としてデプロイする（アクセス許可：全員）。
3. LINE Developers側で「Webhook URL」と「コールバックURL」をGASのURLに設定する。
4. Google フォームの送信トリガーを `onFormSubmit` に設定する。

---
作業ステータス: **完了 (基本機能実装済み)**
最終更新: 2026-01-02 18:55
